const { Client, GatewayIntentBits } = require('discord.js');
const fs = require('fs');
const POINTS_FILE = './points.json';
let points = {};

if (fs.existsSync(POINTS_FILE)) {
  try { points = JSON.parse(fs.readFileSync(POINTS_FILE)); } catch(e){ points = {}; }
}

function savePoints(){ fs.writeFileSync(POINTS_FILE, JSON.stringify(points, null, 2)); }

const client = new Client({ intents: [GatewayIntentBits.Guilds] });

client.once('ready', () => {
  console.log(`âœ… Logged in as ${client.user.tag}`);
});

client.on('interactionCreate', async interaction => {
  if (!interaction.isChatInputCommand()) return;

  const { commandName, options } = interaction;

  if (commandName === 'addpoints') {
    const user = options.getUser('user');
    const amount = options.getInteger('amount');
    if (amount <= 0) return interaction.reply({ content: 'Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±.', ephemeral: true });
    if (!points[user.id]) points[user.id] = 0;
    points[user.id] += amount;
    savePoints();
    return interaction.reply(`âœ… Ø£Ø¶ÙØª ${amount} Ù†Ù‚Ø·Ø© Ù„Ù€ ${user.username}. (Ø§Ù„Ø¢Ù† ${points[user.id]} Ù†Ù‚Ø·Ø©)`);
  }

  if (commandName === 'removepoints') {
    const user = options.getUser('user');
    const amount = options.getInteger('amount');
    if (amount <= 0) return interaction.reply({ content: 'Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±.', ephemeral: true });
    if (!points[user.id]) points[user.id] = 0;
    points[user.id] = Math.max(0, points[user.id] - amount);
    savePoints();
    return interaction.reply(`âŒ Ø³Ø­Ø¨Øª ${amount} Ù†Ù‚Ø·Ø© Ù…Ù† ${user.username}. (Ø§Ù„Ø¢Ù† ${points[user.id]} Ù†Ù‚Ø·Ø©)`);
  }

  if (commandName === 'points') {
    const user = options.getUser('user') || interaction.user;
    const userPoints = points[user.id] || 0;
    return interaction.reply(`ðŸ’° ${user.username} Ø¹Ù†Ø¯Ù‡ ${userPoints} Ù†Ù‚Ø·Ø©.`);
  }
});

client.login(process.env.TOKEN);